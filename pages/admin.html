<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CruciFlix - Painel Administrativo</title>
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="admin-body">
    <!-- Header Admin -->
    <header class="admin-header">
        <a href="dashboard.html" class="admin-logo">
            <i class="fas fa-cross"></i>
            <span>CruciFlix Admin</span>
        </a>
        <div class="admin-user">
            <span id="admin-email">Carregando...</span>
            <button id="btn-logout" class="btn-logout">
                <i class="fas fa-sign-out-alt"></i> Sair
            </button>
        </div>
    </header>

    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <nav class="admin-nav">
                <a href="#" class="nav-item active" data-section="dashboard">
                    <i class="fas fa-chart-line"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-section="movies">
                    <i class="fas fa-film"></i>
                    <span>Filmes</span>
                </a>
                <a href="#" class="nav-item" data-section="series">
                    <i class="fas fa-tv"></i>
                    <span>Séries</span>
                </a>
                <a href="#" class="nav-item" data-section="tags">
                    <i class="fas fa-tags"></i>
                    <span>Tags</span>
                </a>
                <a href="#" class="nav-item" data-section="users">
                    <i class="fas fa-users"></i>
                    <span>Usuários</span>
                </a>
                <a href="#" class="nav-item" data-section="subscriptions">
                    <i class="fas fa-credit-card"></i>
                    <span>Assinaturas</span>
                </a>
                <a href="#" class="nav-item" data-section="comments">
                    <i class="fas fa-comments"></i>
                    <span>Comentários</span>
                </a>
                <a href="#" class="nav-item" data-section="upload">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span>Upload HLS</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <!-- Dashboard Section -->
            <section id="section-dashboard" class="admin-section active">
                <h2><i class="fas fa-chart-line"></i> Dashboard</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-film"></i></div>
                        <div class="stat-info">
                            <span class="stat-value" id="total-movies">0</span>
                            <span class="stat-label">Filmes</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-tv"></i></div>
                        <div class="stat-info">
                            <span class="stat-value" id="total-series">0</span>
                            <span class="stat-label">Séries</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-info">
                            <span class="stat-value" id="total-users">0</span>
                            <span class="stat-label">Usuários</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-crown"></i></div>
                        <div class="stat-info">
                            <span class="stat-value" id="premium-users">0</span>
                            <span class="stat-label">Premium</span>
                        </div>
                    </div>
                </div>

                <div class="dashboard-charts">
                    <div class="chart-card">
                        <h3>Conteúdo Recente</h3>
                        <div id="recent-content" class="recent-list"></div>
                    </div>
                    <div class="chart-card">
                        <h3>Usuários Recentes</h3>
                        <div id="recent-users" class="recent-list"></div>
                    </div>
                </div>
            </section>

            <!-- Movies Section -->
            <section id="section-movies" class="admin-section">
                <h2><i class="fas fa-film"></i> Gerenciar Filmes</h2>
                
                <div class="section-toolbar">
                    <button class="btn-primary" onclick="openMovieModal()">
                        <i class="fas fa-plus"></i> Novo Filme
                    </button>
                    <div class="search-box">
                        <input type="text" id="search-movies" placeholder="Buscar filmes...">
                        <i class="fas fa-search"></i>
                    </div>
                </div>

                <div class="content-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Thumbnail</th>
                                <th>Título</th>
                                <th>Ano</th>
                                <th>Tags</th>
                                <th>Nível</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="movies-list"></tbody>
                    </table>
                </div>
            </section>

            <!-- Series Section -->
            <section id="section-series" class="admin-section">
                <h2><i class="fas fa-tv"></i> Gerenciar Séries</h2>
                
                <div class="section-toolbar">
                    <button class="btn-primary" onclick="openSeriesModal()">
                        <i class="fas fa-plus"></i> Nova Série
                    </button>
                    <div class="search-box">
                        <input type="text" id="search-series" placeholder="Buscar séries...">
                        <i class="fas fa-search"></i>
                    </div>
                </div>

                <div class="content-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Thumbnail</th>
                                <th>Título</th>
                                <th>Temporadas</th>
                                <th>Episódios</th>
                                <th>Tags</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="series-list"></tbody>
                    </table>
                </div>
            </section>

            <!-- Tags Section -->
            <section id="section-tags" class="admin-section">
                <h2><i class="fas fa-tags"></i> Gerenciar Tags</h2>
                
                <div class="section-toolbar">
                    <button class="btn-primary" onclick="openTagModal()">
                        <i class="fas fa-plus"></i> Nova Tag
                    </button>
                </div>

                <div class="tags-grid" id="tags-list"></div>
            </section>

            <!-- Users Section -->
            <section id="section-users" class="admin-section">
                <h2><i class="fas fa-users"></i> Gerenciar Usuários</h2>
                
                <div class="section-toolbar">
                    <div class="filter-group">
                        <select id="filter-subscription">
                            <option value="">Todos os planos</option>
                                <option value="free">Gratuito</option>
                                <option value="basic">Básico</option>
                                <option value="premium">Premium</option>
                        </select>
                    </div>
                    <div class="search-box">
                        <input type="text" id="search-users" placeholder="Buscar usuários...">
                        <i class="fas fa-search"></i>
                    </div>
                </div>

                <div class="content-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Avatar</th>
                                <th>Email</th>
                                <th>Perfis</th>
                                <th>Plano</th>
                                <th>Cadastro</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="users-list"></tbody>
                    </table>
                </div>
            </section>

            <!-- Subscriptions Section -->
            <section id="section-subscriptions" class="admin-section">
                <h2><i class="fas fa-credit-card"></i> Planos de Assinatura</h2>
                
                <div class="subscription-plans">
                    <div class="plan-card free">
                        <div class="plan-header">
                            <h3>Gratuito</h3>
                            <span class="plan-price">R$ 0</span>
                        </div>
                        <ul class="plan-features">
                            <li><i class="fas fa-check"></i> Conteúdo limitado</li>
                            <li><i class="fas fa-check"></i> 1 perfil</li>
                            <li><i class="fas fa-check"></i> Qualidade SD</li>
                            <li><i class="fas fa-times"></i> Sem downloads</li>
                        </ul>
                        <div class="plan-stats">
                            <span id="free-users-count">0</span> usuários
                        </div>
                    </div>
                    
                    <div class="plan-card basic">
                        <div class="plan-header">
                            <h3>Básico</h3>
                            <span class="plan-price">R$ 19,90/mês</span>
                        </div>
                        <ul class="plan-features">
                            <li><i class="fas fa-check"></i> Todo conteúdo</li>
                            <li><i class="fas fa-check"></i> 2 perfis</li>
                            <li><i class="fas fa-check"></i> Qualidade HD</li>
                            <li><i class="fas fa-times"></i> Sem downloads</li>
                        </ul>
                        <div class="plan-stats">
                            <span id="basic-users-count">0</span> usuários
                        </div>
                    </div>
                    
                    <div class="plan-card premium">
                        <div class="plan-popular">Mais Popular</div>
                        <div class="plan-header">
                            <h3>Premium</h3>
                            <span class="plan-price">R$ 39,90/mês</span>
                        </div>
                        <ul class="plan-features">
                            <li><i class="fas fa-check"></i> Todo conteúdo</li>
                            <li><i class="fas fa-check"></i> 5 perfis</li>
                            <li><i class="fas fa-check"></i> Qualidade 4K</li>
                            <li><i class="fas fa-check"></i> Downloads offline</li>
                        </ul>
                        <div class="plan-stats">
                            <span id="premium-users-count">0</span> usuários
                        </div>
                    </div>
                </div>

                <div class="subscription-note">
                    <i class="fas fa-info-circle"></i>
                    <p>Os planos são apenas para demonstração visual.</p>
                </div>
            </section>

            <!-- Comments Section -->
            <section id="section-comments" class="admin-section">
                <h2><i class="fas fa-comments"></i> Moderação de Comentários</h2>
                
                <div class="section-toolbar">
                    <div class="filter-group">
                        <select id="filter-comments">
                            <option value="pending">Pendentes</option>
                            <option value="approved">Aprovados</option>
                            <option value="all">Todos</option>
                        </select>
                    </div>
                </div>

                <div class="comments-list" id="comments-list"></div>
            </section>

            <!-- Upload HLS Section -->
            <section id="section-upload" class="admin-section">
                <h2><i class="fas fa-cloud-upload-alt"></i> Upload de Vídeo HLS</h2>
                
                <div class="upload-container">
                    <div class="upload-info">
                        <i class="fas fa-info-circle"></i>
                        <p>Para vídeos HLS, faça upload do arquivo de vídeo (.mp4, .mov).</p>
                    </div>
                    
                    <form id="upload-form" class="upload-form">
                        <div class="form-group">
                            <label>Arquivo de vídeo (ou deixe vazio e forneça um link HLS)</label>
                            <input type="file" id="upload-video-file" accept="video/*">
                        </div>

                        <div class="form-group">
                            <label>OU URL do manifesto HLS (.m3u8)</label>
                            <input type="url" id="hls-url" placeholder="https://storage.googleapis.com/...">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Tipo de conteúdo</label>
                                <select id="upload-content-type" onchange="toggleEpisodeFields()">
                                    <option value="MOVIE">Filme</option>
                                    <option value="EPISODE">Episódio de Série</option>
                                </select>
                            </div>
                            <div class="form-group" id="series-select-group" style="display: none;">
                                <label>Série</label>
                                <select id="upload-series-id"></select>
                            </div>
                        </div>
                        
                        <div class="form-row episode-fields" style="display: none;">
                            <div class="form-group">
                                <label>Temporada</label>
                                <input type="number" id="upload-season" min="1" value="1">
                            </div>
                            <div class="form-group">
                                <label>Número do Episódio</label>
                                <input type="number" id="upload-episode" min="1" value="1">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Título</label>
                            <input type="text" id="upload-title" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Descrição</label>
                            <textarea id="upload-description" rows="3"></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Thumbnail (arquivo ou URL)</label>
                                <input type="file" id="upload-thumbnail-file" accept="image/*">
                                <input type="url" id="upload-thumbnail" placeholder="https://... (opcional se enviar arquivo)">
                            </div>
                            <div class="form-group">
                                <label>Duração (minutos)</label>
                                <input type="number" id="upload-duration" min="1" placeholder="Preenchido automaticamente ao enviar arquivo">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Banner / Hero (arquivo de imagem)</label>
                                <input type="file" id="upload-banner-file" accept="image/*">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Tags</label>
                            <div class="tags-selector" id="upload-tags-selector"></div>
                        </div>
                        
                        <div class="form-group">
                            <label>Nível de Assinatura Mínimo</label>
                            <select id="upload-subscription-level">
                                <option value="FREE">Gratuito</option>
                                <option value="BASIC">Básico</option>
                                <option value="PREMIUM">Premium</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="btn-primary btn-large">
                            <i class="fas fa-save"></i> Salvar Conteúdo
                        </button>
                    </form>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal: Novo Filme -->
    <div id="movie-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="movie-modal-title">Novo Filme</h3>
                <button class="modal-close" onclick="closeMovieModal()">&times;</button>
            </div>
            <form id="movie-form">
                <input type="hidden" id="movie-id">
                
                <div class="form-group">
                    <label>Título *</label>
                    <input type="text" id="movie-title" required>
                </div>
                
                <div class="form-group">
                    <label>Descrição</label>
                    <textarea id="movie-description" rows="3"></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Ano</label>
                        <input type="number" id="movie-year" min="1900" max="2099">
                    </div>
                    <div class="form-group">
                        <label>Duração (min)</label>
                        <input type="number" id="movie-duration" min="1">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>URL do Vídeo HLS (.m3u8) *</label>
                    <input type="url" id="movie-video-url" required>
                </div>
                
                <div class="form-group">
                    <label>Thumbnail (arquivo ou URL)</label>
                    <input type="file" id="movie-thumbnail-file" accept="image/*">
                    <input type="url" id="movie-thumbnail" placeholder="https://... (ou envie arquivo acima)">
                    <div id="movie-thumbnail-preview" class="image-preview"></div>
                </div>
                
                <div class="form-group">
                    <label>Banner / Hero (arquivo ou URL)</label>
                    <input type="file" id="movie-banner-file" accept="image/*">
                    <input type="url" id="movie-banner" placeholder="https://... (ou envie arquivo acima)">
                    <div id="movie-banner-preview" class="image-preview"></div>
                </div>
                
                <div class="form-group">
                    <label>Classificação Indicativa</label>
                    <select id="movie-rating">
                        <option value="L">L - Livre</option>
                        <option value="10">10 - Não recomendado para menores de 10 anos</option>
                        <option value="12">12 - Não recomendado para menores de 12 anos</option>
                        <option value="14">14 - Não recomendado para menores de 14 anos</option>
                        <option value="16">16 - Não recomendado para menores de 16 anos</option>
                        <option value="18">18 - Não recomendado para menores de 18 anos</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="movie-is-kids"> Seguro para crianças (exibir em Kids)
                    </label>
                </div>
                
                <div class="form-group">
                    <label>Tags</label>
                    <div class="tags-selector" id="movie-tags-selector"></div>
                </div>
                
                <div class="form-group">
                    <label>Nível Mínimo de Assinatura</label>
                    <select id="movie-subscription-level">
                        <option value="free">Gratuito</option>
                        <option value="basic">Básico</option>
                        <option value="premium">Premium</option>
                    </select>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeMovieModal()">Cancelar</button>
                    <button type="submit" class="btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Nova Série -->
    <div id="series-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="series-modal-title">Nova Série</h3>
                <button class="modal-close" onclick="closeSeriesModal()">&times;</button>
            </div>
            <form id="series-form">
                <input type="hidden" id="series-id">
                
                <div class="form-group">
                    <label>Título *</label>
                    <input type="text" id="series-title" required>
                </div>
                
                <div class="form-group">
                    <label>Descrição</label>
                    <textarea id="series-description" rows="3"></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Ano de Início</label>
                        <input type="number" id="series-year" min="1900" max="2099">
                    </div>
                    <div class="form-group">
                        <label>Total de Temporadas</label>
                        <input type="number" id="series-seasons" min="1" value="1">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Thumbnail (arquivo ou URL)</label>
                    <input type="file" id="series-thumbnail-file" accept="image/*">
                    <input type="url" id="series-thumbnail" placeholder="https://... (ou envie arquivo acima)">
                    <div id="series-thumbnail-preview" class="image-preview"></div>
                </div>
                
                <div class="form-group">
                    <label>Banner / Hero (arquivo ou URL)</label>
                    <input type="file" id="series-banner-file" accept="image/*">
                    <input type="url" id="series-banner" placeholder="https://... (ou envie arquivo acima)">
                    <div id="series-banner-preview" class="image-preview"></div>
                </div>
                
                <div class="form-group">
                    <label>Classificação Indicativa</label>
                    <select id="series-rating">
                        <option value="L">L - Livre</option>
                        <option value="10">10 - Não recomendado para menores de 10 anos</option>
                        <option value="12">12 - Não recomendado para menores de 12 anos</option>
                        <option value="14">14 - Não recomendado para menores de 14 anos</option>
                        <option value="16">16 - Não recomendado para menores de 16 anos</option>
                        <option value="18">18 - Não recomendado para menores de 18 anos</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="series-is-kids"> Seguro para crianças (exibir em Kids)
                    </label>
                </div>
                
                <div class="form-group">
                    <label>Tags</label>
                    <div class="tags-selector" id="series-tags-selector"></div>
                </div>
                
                <div class="form-group">
                    <label>Nível Mínimo de Assinatura</label>
                    <select id="series-subscription-level">
                        <option value="free">Gratuito</option>
                        <option value="basic">Básico</option>
                        <option value="premium">Premium</option>
                    </select>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeSeriesModal()">Cancelar</button>
                    <button type="submit" class="btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Episódios da Série -->
    <div id="episodes-modal" class="modal modal-large">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="episodes-modal-title">Episódios</h3>
                <button class="modal-close" onclick="closeEpisodesModal()">&times;</button>
            </div>
            <div class="episodes-container">
                <div class="episodes-toolbar">
                    <button class="btn-primary" onclick="openEpisodeForm()">
                        <i class="fas fa-plus"></i> Novo Episódio
                    </button>
                    <select id="season-filter" onchange="filterEpisodesBySeason()">
                        <option value="">Todas as temporadas</option>
                    </select>
                </div>
                
                <div id="episode-form-container" style="display: none;">
                    <form id="episode-form">
                        <input type="hidden" id="episode-id">
                        <input type="hidden" id="episode-series-id">
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Temporada *</label>
                                <input type="number" id="episode-season" min="1" value="1" required>
                            </div>
                            <div class="form-group">
                                <label>Número *</label>
                                <input type="number" id="episode-number" min="1" value="1" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Título *</label>
                            <input type="text" id="episode-title" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Descrição</label>
                            <textarea id="episode-description" rows="2"></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>URL do Vídeo HLS *</label>
                                <input type="url" id="episode-video-url" required>
                            </div>
                            <div class="form-group">
                                <label>Duração (min)</label>
                                <input type="number" id="episode-duration" min="1">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Thumbnail (arquivo ou URL)</label>
                            <input type="file" id="episode-thumbnail-file" accept="image/*">
                            <input type="url" id="episode-thumbnail" placeholder="https://... (ou envie arquivo acima)">
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn-secondary" onclick="closeEpisodeForm()">Cancelar</button>
                            <button type="submit" class="btn-primary">Salvar Episódio</button>
                        </div>
                    </form>
                </div>
                
                <div class="episodes-list" id="episodes-list"></div>
            </div>
        </div>
    </div>

    <!-- Modal: Nova Tag -->
    <div id="tag-modal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3 id="tag-modal-title">Nova Tag</h3>
                <button class="modal-close" onclick="closeTagModal()">&times;</button>
            </div>
            <form id="tag-form">
                <input type="hidden" id="tag-id">
                
                <div class="form-group">
                    <label>Nome da Tag *</label>
                    <input type="text" id="tag-name" required placeholder="Ex: Ação, Drama, Documentário">
                </div>
                
                <div class="form-group">
                    <label>Cor</label>
                    <div class="color-input-wrapper" style="display:flex;align-items:center;gap:10px;">
                        <input type="color" id="tag-color" value="#e50914" style="width:56px;height:36px;padding:0;border:1px solid #ccc;border-radius:4px;cursor:pointer;">
                        <div id="tag-color-preview" style="width:36px;height:36px;border-radius:4px;border:1px solid #ccc;background:#e50914;"></div>
                        <input type="text" id="tag-color-hex" value="#e50914" style="width:100px;padding:6px;border:1px solid #ccc;border-radius:4px;">
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeTagModal()">Cancelar</button>
                    <button type="submit" class="btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <script src="../scripts/app-core.js"></script>
    <script src="../scripts/app-catalog.js"></script>
    <script src="../scripts/app-admin.js"></script>
    
    <!-- Modal: Sem Permissão (apenas visível para usuários não-admin) -->
    <div id="no-permission-modal" aria-hidden="true">
        <div class="no-perm-box">
            <h3>Sem Permissão</h3>
            <p>Você não tem permissão para acessar o painel administrativo.</p>
            <p style="font-size:0.9rem;color:#aaa;margin-top:8px;">Conta: <span id="no-perm-email">-</span></p>
            <div style="margin-top:18px;display:flex;gap:10px;justify-content:center;">
                <button id="no-perm-logout" class="btn-primary">Sair</button>
                <button id="no-perm-back" class="btn-secondary">Voltar ao site</button>
            </div>
        </div>
    </div>
</body>
</html>
